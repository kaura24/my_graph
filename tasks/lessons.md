# Lessons Learned

사용자 수정/피드백 후 여기에 패턴과 규칙을 기록한다. 같은 실수를 반복하지 않기 위한 문서.

---

### [2026-02-27] Python 리팩토링 자율 진행 결정
- **상황**: todo.md에 "사용자 스펙 리뷰 대기 중"으로 блокировано되어 있던 Planning 1단계를 사용자가 "스스로 결정해서 진행"하도록 지시함.
- **교훈**: 명확한 PRD와 AGENT_CONTEXT가 있으면 추가 리뷰 없이 스스로 아키텍처를 결정하고 진행 가능.
- **규칙**: 스펙이 충분히 문서화된 경우 사용자 리뷰 대기 없이 자율 결정 후 진행. 완료 후 보고.

### [2026-02-27] 어댑터 파일 내용이 diff 형식으로 저장된 문제
- **상황**: `graphAdapter.ts`, `sqliteAdapter.ts`, `vectorAdapter.ts`가 실제 코드가 아닌 diff 텍스트로 저장되어 있었음. IDE에서 lint 오류 다수 발생.
- **교훈**: 파일을 처음 볼 때 내용 이상 여부(diff 형식, 잘못된 인코딩 등)를 반드시 확인.
- **규칙**: 기존 파일 수정 전 반드시 `view_file`로 실제 내용을 확인한 후 overwrite 결정.

### [2026-02-27] 중간 진행 멈춤 — 사용자 메시지로 인한 태스크 인터럽트
- **상황**: 작업 중간에 사용자 메시지가 수신되면 task_boundary가 종료되어 멈춘 것처럼 보임.
- **교훈**: 사용자 메시지는 진행 방향 확인이 목적이므로, 취지를 읽고 즉시 재진입해 계속 진행.
- **규칙**: 사용자 코멘트가 취소 의미가 아닌 경우 즉시 task_boundary 재진입 후 작업 계속.

### [2026-02-28] 문서 생성 UX 불편 피드백
- **상황**: 문서 생성 시 제목 입력 UI를 거쳐야 해서 생성이 느리고 불편하다는 피드백이 발생.
- **교훈**: 작성 도구의 핵심 액션(새 문서)은 입력 단계보다 즉시 생성 + 즉시 편집이 우선이다.
- **규칙**: 새 문서는 1클릭/단축키로 즉시 생성 가능해야 하며, 제목 수정은 에디터에서 후속 처리한다.

### [2026-02-28] 동일 제목으로 신규 생성 시 덮어쓰기 발생
- **상황**: 기본 제목 `새메모`로 연속 생성 시 기존 문서가 추가되지 않고 덮어써짐.
- **교훈**: 신규 생성의 식별자는 제목과 분리된 고유 ID를 사용해야 한다.
- **규칙**: `doc_id` 없는 생성 요청은 항상 고유 ID를 발급하고, 제목은 메타 정보로만 관리한다.

### [2026-02-28] 그림 파일 붙여넣기 시 이미지 판별 실패
- **상황**: Windows 클립보드/드래그에서 전달된 파일의 MIME type이 비어 있어 이미지가 일반 파일로 처리됨.
- **교훈**: 파일 타입 판별은 MIME만 믿지 말고 확장자 fallback을 함께 써야 한다.
- **규칙**: 붙여넣기/드롭/파일선택의 이미지 판별 로직은 `file.type.startsWith("image/") || 확장자`로 통일한다.
